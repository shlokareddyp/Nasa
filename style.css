:root{
  --bg:#0b1424; --panel:#0f1b32; --card:#0f1b32; --ink:#e8f1ff; --ink-dim:#a9b9d8;
  --line:#1b2a49; --accent:#7aa2ff; --chip:#111e36; --good:#3ad38c; --warn:#ffb020; --bad:#ff6b6b;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
body.hc{filter:contrast(1.15) saturate(1.1)}

.topbar{position:sticky;top:0;z-index:30;background:#081223cc;backdrop-filter:blur(8px);
  display:flex;gap:10px;align-items:center;padding:8px 10px;border-bottom:1px solid var(--line);}
.topbar .row{display:flex;align-items:center;gap:6px}

.layout{display:grid;grid-template-columns:320px 1fr;gap:0;min-height:calc(100vh - 48px);}
.panel{padding:12px;border-right:1px solid var(--line);}
.panel h3{margin:8px 0 12px 0;display:flex;gap:8px;align-items:center}
.badge{display:inline-block;padding:2px 6px;border:1px solid var(--line);border-radius:8px;background:#13203a;color:#9fc2ff;font-size:12px}
.hidden{display:none !important}

.kv{display:grid;grid-template-columns:1fr auto auto;gap:6px;align-items:center;
  padding:6px 0;border-bottom:1px dashed var(--line)}
.kv span{opacity:.85;color:var(--ink-dim)}
.kv strong{font-variant-numeric:tabular-nums}
.kv em{opacity:.6;font-style:normal;font-size:12px}

.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;margin:12px 0;}
.card h4{margin:0 0 8px 0}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.wfull{width:100%}

.chip{background:var(--chip);color:var(--ink);border:1px solid var(--line);border-radius:10px;
  padding:6px 10px;cursor:pointer}
.chip:hover{border-color:var(--accent)}
.chip.small{padding:4px 8px;font-size:12px}
.mini{font-size:12px;opacity:.85}

.sceneWrap{position:relative}
#scene{width:100%;height:calc(100vh - 48px);display:block;background:radial-gradient(ellipse at 50% 120%, #0a1324, #050a17)}
.audioStatus{position:fixed;left:10px;bottom:10px;opacity:.7;font-size:12px}

/* floating activity dock on the right */
.dock{
  position:absolute; right:14px; top:14px; width:280px; display:grid; gap:10px; z-index:20;
}
.dockCard{
  background:#0b162bcc; backdrop-filter:blur(8px);
  border:1px solid var(--line); border-radius:12px; padding:10px;
}
.dockTitle{font-size:12px; opacity:.9; margin-bottom:6px; color:#cfe2ff}
.feed{display:grid; gap:6px; max-height:220px; overflow:auto}
.feedRow{font-size:12px; color:#cfe2ff; opacity:.9; border-bottom:1px dashed #163057; padding-bottom:4px}
.meter{height:8px; width:100%; background:#0e1b33; border:1px solid var(--line); border-radius:999px; overflow:hidden}
.meterBar{height:100%; width:10%; background:linear-gradient(90deg,#7aa2ff,#66ff99)}

/* bottom mini-HUD */
.miniHud{
  position:absolute; left:50%; bottom:18px; transform:translateX(-50%);
  display:flex; gap:16px; z-index:18;
}
.hudCard{
  background:#0b162bcc; backdrop-filter:blur(8px);
  border:1px solid var(--line); border-radius:14px;
  padding:10px 14px; width:200px;
}
.hudLabel{font-size:12px; color:#9fb0d6}
.hudValue{font-size:20px; font-weight:700; margin-top:4px}
.hudValue.good{color:var(--good)} .hudValue.warn{color:var(--warn)} .hudValue.bad{color:var(--bad)}

/* overlays */
.overlay{position:fixed;inset:0;background:rgba(7,12,22,.6);backdrop-filter:blur(6px);
  display:flex;align-items:flex-start;justify-content:center;padding:24px;z-index:50;}
.sheet{width:min(920px,calc(100vw - 32px));max-height:calc(100vh - 48px);overflow:auto;
  border:1px solid var(--line);border-radius:14px;background:#0b162b;}
.sheetHead{position:sticky;top:0;background:#0b162b;border-bottom:1px solid var(--line);
  padding:10px;display:flex;align-items:center;gap:10px}
.sheet .card{margin:12px}

.quizFab{position:fixed;right:14px;bottom:14px;z-index:20}

/* inputs */
input[type="range"]{accent-color:var(--accent)}
select, input[type="number"]{background:#0b162b;color:var(--ink);border:1px solid var(--line);border-radius:8px;padding:4px 6px}

/* story styles */
.storyBody{padding:12px}
.storyWrap{display:grid; grid-template-columns:220px 1fr; gap:12px; align-items:center}
.illust{width:100%; height:auto; background:#0a1324; border:1px solid #1e2a44; border-radius:10px}
.storyText{font-size:14px; color:#d6e3ff; line-height:1.55}
.choices{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}

/* responsive */
@media (max-width: 1100px){
  .hudCard{width:160px}
}
@media (max-width: 880px){
  .layout{grid-template-columns:1fr}
  .panel{border-right:none; border-bottom:1px solid var(--line)}
  #scene{height:60vh}
  .dock{position:static; width:auto; grid-template-columns:1fr; padding:10px}
  .storyWrap{grid-template-columns:1fr}
  .miniHud{left:12px; right:12px; transform:none; justify-content:space-between; gap:8px}
  .hudCard{flex:1}
}
